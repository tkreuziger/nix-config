#!/bin/bash

options=$(pactl list sinks | grep -E "^\s*Description:" | sed 's/.*Description: //')

selection=$(echo "$options" | dmenu -i -l 5 -p "Output:")

sink_name=$(pactl list sinks | awk -v target="$selection" '
/^Sink #/ { sink_name = "" }
/Name:/ { sink_name = $2 }
/Description:/ {
    desc = $0
    gsub(/.*Description: /, "", desc)
    if (desc == target) print sink_name
}')

if [ -n "$sink_name" ]; then
    pactl set-default-sink "$sink_name" && notify-send "Audio switched to: $selection"
else
    notify-send "Audio switch failed"
fi
